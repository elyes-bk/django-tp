{% extends "main/base.html" %}

{% block title %}Accueil{% endblock %}

{% block extra_css %}
<style>
    .search-bar {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 0.5rem;
        margin-bottom: 1.5rem;
    }

    .search-bar input,
    .search-bar select,
    .search-bar button {
        padding: 0.5rem;
        font-size: 1rem;
    }

    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 1rem;
    }

    .card {
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        transition: transform 0.2s;
    }

    .card:hover {
        transform: translateY(-3px);
    }

    .card img {
        width: 100%;
        height: 180px;
        object-fit: cover;
    }

    .card-content {
        padding: 0.75rem;
    }

    .pagination {
        margin-top: 2rem;
        text-align: center;
    }

    .pagination a {
        margin: 0 0.5rem;
    }
</style>
{% endblock %}

{% block content %}

<form method="get" class="search-bar">
    <input type="text" name="q" placeholder="Mot-clé" value="{{ request.GET.q }}">

    <select name="typologie">
        <option value="">Toutes les typologies</option>
        {% for t in typologies %}
            <option value="{{ t.id }}" {% if request.GET.typologie == t.id|stringformat:"s" %}selected{% endif %}>
                {{ t.nom }}
            </option>
        {% endfor %}
    </select>

    <select name="denomination">
        <option value="">Toutes les dénominations</option>
        {% for d in denominations %}
            <option value="{{ d.id }}" {% if request.GET.denomination == d.id|stringformat:"s" %}selected{% endif %}>
                {{ d.nom }}
            </option>
        {% endfor %}
    </select>

    <select name="olympiade">
        <option value="">Toutes les olympiades</option>
        {% for o in olympiades %}
            <option value="{{ o.id }}" {% if request.GET.olympiade == o.id|stringformat:"s" %}selected{% endif %}>
                {{ o.nom }}
            </option>
        {% endfor %}
    </select>

    <button type="submit">Rechercher</button>
</form>

<div class="grid">
    {% for site in page_obj %}
        <div class="card">
            {% if site.url_image %}
                <img src="{{ site.url_image }}" alt="{{ site.nom }}">
            {% endif %}
            <div class="card-content">
                <h3>
                    <a href="{% url 'site_detail' site.id %}">{{ site.nom }}</a>
                </h3>
                <p>{{ site.commune }} ({{ site.departement }})</p>
            </div>
        </div>
    {% empty %}
        <p>Aucun résultat.</p>
    {% endfor %}
</div>

<div class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}">← Précédent</a>
    {% endif %}

    Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">Suivant →</a>
    {% endif %}
</div>

{% endblock %}
